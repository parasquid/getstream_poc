<script src="https://cdn.jsdelivr.net/npm/getstream/dist/js_min/getstream.js"></script>

hello!

<div id="timer"></div>
<p><button id="add-activity">Add activity</button>

<script>
  var interval
  var client = stream.connect('<%= @apikey %>', null,  '<%= @appid %>');

  var userFeed = client.feed('user', '<%= @user_id %>', '<%= @user_token %>')
  var userSubscription = userFeed.subscribe(
    () => userFeed.get()
      .then(streamData => console.log(streamData))
      .then(() => clearInterval(interval)),
    (errors) => console.error({errors})
  );

  var notificationFeed = client.feed('notification', '<%= @user_id %>', '<%= @notification_token %>')
  var notificationSubscription = notificationFeed.subscribe(
    () => notificationFeed.get().then(streamData => console.log(streamData)),
    (errors) => console.error({errors})
  );

  button = document.querySelector("button#add-activity")
  button.onclick = (e) => {
    timer = document.querySelector("div#timer");
    var seconds = 0
    interval = setInterval(() => {
      seconds++;
      timer.innerHTML = seconds;
    }, 1000);

    fetch("/add_activity")
      .then(r => r.json())
      .then(json => console.log(json));
  }

</script>
